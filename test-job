def appNames = ["harnessweb", "harvey-integration", "judgesAssistant", "stewards-portal", "webapi"]
def EnvironmentName = "dev"
def startTime = 11 // Use integers, not strings
def stopTime = 15 // Use integers, not strings
def size = 1

pipeline {
  agent any
  triggers {
    cron('0 12,13 * * *') // Trigger at 12:00 PM (noon)
  }
  stages {
    stage('LOOP') {
      steps {
        script {
          def currentHour = new Date().format("HH")
          appNames.each { appName ->
            def constructedString = "rise-${appName}-${EnvironmentName}-ASG"
            if (currentHour.toInteger() == startTime) { 
              size = 1
              echo "$size"
            } else if (currentHour.toInteger() == stopTime) {
              echo "Hello Afternoon"
              size = 0
            } else {
              echo "The start or stopTime is not configured correctly, Please Verify"
            }
            try {
              sh """aws autoscaling update-auto-scaling-group \
                --auto-scaling-group-name 'rise-${appName}-${EnvironmentName}-ASG' \
                --min-size $size \
                --max-size $size \
                --desired-capacity $size
              """
              echo size
            } catch (Exception e) {
              currentBuild.result = 'SUCCESS' // Set the result to SUCCESS even if the sh command fails
              echo "Exception occurred: ${e.message}"
            }
          }
        }
      }
    }
  }
}
